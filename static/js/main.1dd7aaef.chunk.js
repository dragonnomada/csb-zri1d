(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{94:function(e,t,n){"use strict";n.r(t);var c,r,o,a=n(4),i=n.n(a),s=n(73),u=n.n(s),d=n(17),l=n(51),j=n(3),b=n.n(j),p=n(7),h=n(56),f=n(22),O=n(5),x="application-0-rugmi",g=new h.a(x);function v(){return y.apply(this,arguments)}function y(){return(y=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.currentUser){e.next=5;break}return e.next=3,g.logIn(h.b.anonymous());case 3:e.next=7;break;case 5:return e.next=7,g.currentUser.refreshCustomData();case 7:return e.abrupt("return",g.currentUser.accessToken);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=new f.ApolloClient({link:new f.HttpLink({uri:"https://us-east-1.aws.realm.mongodb.com/api/client/v2.0/app/".concat(x,"/graphql"),fetch:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(p.a)(b.a.mark((function e(t,n){var c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v();case 2:return c=e.sent,n.headers.Authorization="Bearer ".concat(c),e.abrupt("return",fetch(t,n));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}),cache:new f.InMemoryCache}),m=Object(f.gql)(c||(c=Object(l.a)(["\n  mutation AddTodo($title: String!) {\n    todo: addSimpleTodo(input: $title) {\n      _id\n      title\n      checked\n      createAt\n      updateAt\n    }\n  }\n"]))),A=i.a.createContext({});function w(){var e=Object(f.useMutation)(m),t=Object(d.a)(e,2),n=t[0],c=t[1],r=c.error,o=c.loading,i=c.called,s=c.data,u=Object(a.useState)(""),l=Object(d.a)(u,2),j=l[0],b=l[1],p=Object(a.useContext)(A).refreshTodos,h=Object(a.useRef)();return Object(a.useEffect)((function(){!o&&i&&"function"===typeof p&&(console.log("main",p),p(),b(""),h.current.focus())}),[o,i,p]),Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{children:[Object(O.jsx)("input",{ref:h,placeholder:"Escribe algo por hacer...",value:j,onChange:function(e){b(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&j&&n({variables:{title:j}})}}),Object(O.jsx)("button",{onClick:function(){j&&n({variables:{title:j}})},children:"Agregar"})]}),o&&Object(O.jsx)("span",{children:"Agregando..."}),r&&Object(O.jsx)("span",{style:{color:"red"},children:JSON.stringify(r)}),s&&Object(O.jsx)("div",{children:Object(O.jsxs)("span",{children:['Se ha agregado "',s.todo.title,'"']})})]})}var S=Object(f.gql)(r||(r=Object(l.a)(["\n  mutation UpdateTodo($query: TodoQueryInput!, $todo: TodoUpdateInput!) {\n    todo: updateOneTodo(query: $query, set: $todo) {\n      _id\n      title\n      checked\n      createAt\n      updateAt\n    }\n  }\n"])));function C(e){var t=e.todo,n=Object(f.useMutation)(S),c=Object(d.a)(n,2),r=c[0],o=c[1],i=o.error,s=o.loading,u=(o.called,o.data,Object(a.useRef)());return Object(O.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(O.jsx)("div",{style:{paddingRight:"4px"},children:Object(O.jsx)("input",{ref:u,disabled:i||s,type:"checkbox",checked:t.checked,onChange:function(e){r({variables:{query:{_id:t._id},todo:{checked:e.target.checked,updateAt:new Date}}})}})}),Object(O.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){u.current.click()},children:[Object(O.jsx)("div",{children:Object(O.jsx)("span",{style:{textDecoration:t.checked?"line-through":"initial"},children:t.title})}),Object(O.jsx)("div",{children:Object(O.jsx)("span",{style:{fontSize:"0.8em",color:"gray"},children:new Date(t.updateAt||t.createAt||new Date).toLocaleString()})})]})]},t._id)}var T=Object(f.gql)(o||(o=Object(l.a)(["\n  query {\n    todos {\n      _id\n      title\n      checked\n      createAt\n      updateAt\n    }\n  }\n"])));function q(){var e=Object(f.useLazyQuery)(T),t=Object(d.a)(e,2),n=t[0],c=t[1],r=c.error,o=c.loading,i=c.data,s=c.called,u=c.refetch,l=Object(a.useState)(30),j=Object(d.a)(l,2),b=j[0],p=j[1],h=Object(a.useContext)(A).subscribeRefreshTodos;return Object(a.useEffect)((function(){!o&&s&&h&&"function"===typeof u&&(console.log("updating refresh function"),h((function(){return function(){return u()}})))}),[u,o,s]),Object(a.useEffect)((function(){n()}),[]),Object(a.useEffect)((function(){return b<=0&&!o&&s&&(console.log("refresh"),u(),p(30)),function(){null}}),[b,s,o]),r?Object(O.jsx)("span",{style:{color:"red"},children:JSON.stringify(r)}):o?Object(O.jsx)("span",{children:"Cargando..."}):i?Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{style:{paddingBottom:"8px"},children:[Object(O.jsx)("button",{disabled:!s,onClick:function(){console.log("rtt",u),u(),p(30)},children:"Actualizar"}),Object(O.jsxs)("span",{children:["Se actualizar\xe1 en ",b,"s"]})]}),i.todos.map((function(e){return Object(O.jsx)(C,{todo:e},e._id)}))]}):Object(O.jsx)("span",{children:"Esperando..."})}function E(){var e=Object(a.useState)(null),t=Object(d.a)(e,2),n=t[0],c=t[1];return Object(O.jsx)(f.ApolloProvider,{client:k,children:Object(O.jsx)(A.Provider,{value:{refreshTodos:n,subscribeRefreshTodos:c},children:Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(w,{}),Object(O.jsx)(q,{})]})})})}var _=document.getElementById("root");u.a.render(Object(O.jsx)(a.StrictMode,{children:Object(O.jsx)(E,{})}),_)}},[[94,1,2]]]);
//# sourceMappingURL=main.1dd7aaef.chunk.js.map